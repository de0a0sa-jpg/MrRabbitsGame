<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mr. Rabbit's Game</title>
  <meta name="description" content="Plataforma para debates filos√≥ficos semanales con premios. Reflexiona. Responde. Gana."/>   
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Libre Baskerville"', 'serif'],
            serif: ['"Cormorant Garamond"', 'serif'],
           },
          colors: { 'soft-black': '#000000', 'soft-white': '#fafafa' },
          boxShadow: { 'soft': '0 4px 12px rgba(0, 0, 0, 0.08)', 'soft-dark': '0 4px 16px rgba(0, 0, 0, 0.4)' },
          backdropBlur: { 'lg': '15px' },
          animation: {
            'slide-up': 'slide-up 0.5s ease-out', 'shine': 'shine 2s linear infinite', 'neon-pulse': 'neon-pulse 2s ease-in-out infinite alternate',
            'glitch': 'glitch 2s infinite', 'bounce-star': 'bounce-star 1.5s ease-in-out infinite', 'pulse-button': 'pulse-button 2s infinite',
            'pulse-glow-dark': 'pulse-glow-dark 2s infinite',
          },
          keyframes: {
            'slide-up': { '0%': { opacity: '0', transform: 'translateY(12px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            'shine': { '0%': { backgroundPosition: '-100%' }, '100%': { backgroundPosition: '200%' } },
            'neon-pulse': { '0%': { textShadow: '0 0 5px #ff0, 0 0 10px #ff0, 0 0 15px #ff0' }, '100%': { textShadow: '0 0 10px #ff0, 0 0 20px #ff0, 0 0 30px #ff0' } },
            'glitch': { '0%, 100%': { textShadow: '0 0 5px #ff0, 0 0 10px #ff0' }, '25%': { textShadow: '-2px 0 #0ff, 2px 0 #f0f' }, '50%': { textShadow: '0 0 5px #0f0, 0 0 10px #00f' }, '75%': { textShadow: '2px 0 #f00, -2px 0 #0f0' } },
            'bounce-star': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
            'pulse-button': { '0%': { boxShadow: '0 0 10px rgba(255, 255, 0, 0.3)' }, '50%': { boxShadow: '0 0 20px rgba(255, 255, 0, 0.6), 0 0 30px rgba(255, 255, 0, 0.4)' }, '100%': { boxShadow: '0 0 10px rgba(255, 255, 0, 0.3)' } },
            'pulse-glow-dark': {
              '0%': { boxShadow: '0 0 0 0 rgba(255, 215, 0, 0.7), inset 0 0 15px rgba(255, 215, 0, 0.3)' },
              '50%': { boxShadow: '0 0 20px 5px rgba(255, 215, 0, 0.9), inset 0 0 25px rgba(255, 215, 0, 0.5)' },
              '100%': { boxShadow: '0 0 0 0 rgba(255, 215, 0, 0.7), inset 0 0 15px rgba(255, 215, 0, 0.3)' }
            }
          }
        },
      },
    };
  </script>
  <style>
    body { font-family: 'Libre Baskerville', serif; transition: background-color 0.3s ease, color 0.3s ease; }
    h1, h2, h3, .active-tab, .badge-glow span { font-family: 'Cormorant Garamond', serif; font-weight: 600; }
    .active-tab { @apply relative text-black dark:text-white; }
    .active-tab::after { content: ''; @apply absolute -bottom-0.5 left-0 w-full h-0.5 bg-black dark:bg-white transition-transform duration-300 scale-x-100; }
    .card-hover { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); border: 1px solid rgba(255, 255, 255, 0.1); background: white; transform: translateY(0); position: relative; z-index: 1; overflow: hidden; border-radius: 1.5rem; }
    .dark .card-hover { background: #000; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5); }
    .card-hover:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12), 0 8px 8px rgba(0, 0, 0, 0.08); }
    .dark .card-hover:hover { box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6), 0 8px 12px rgba(0, 0, 0, 0.3); border-color: rgba(255, 255, 255, 0.15); }
    .elegant-card { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); background: white; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); position: relative; }
    .dark .elegant-card { background: #000; border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
    .elegant-card:hover { transform: translateY(-6px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12), 0 8px 8px rgba(0, 0, 0, 0.08); }
    .dark .elegant-card:hover { box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 8px 12px rgba(0, 0, 0, 0.2); }
    .elegant-card strong { font-size: 1.125rem; color: #1e293b; font-weight: 600; }
    .dark .elegant-card strong { color: #f8fafc; }
    .elegant-card p { margin-top: 0.5rem; font-size: 0.875rem; color: #64748b; }
    .dark .elegant-card p { color: #94a3b8; }
    .glitch-name { background: linear-gradient(90deg, #ff0, #f0f, #0ff, #0f0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; background-size: 200% auto; animation: glitch 2s infinite, shine 2s linear infinite; }
    @keyframes shine { to { background-position: 200% center; } }
    .dark .btn-respond-glow { animation: pulse-glow-dark 2s infinite; border: none; outline: none; }
    #mobile-menu-button { @apply sm:hidden; }
    #mobile-menu { @apply sm:hidden bg-white dark:bg-soft-black border-t border-gray-200 dark:border-gray-700 px-4 py-2; }
    #mobile-menu.hidden { display: none; }
  </style>
</head>
<body class="bg-soft-white text-gray-900 dark:bg-soft-black dark:text-gray-200 min-h-screen">

  <!-- Encabezado -->
  <header class="sticky top-0 z-40 py-6 bg-white/80 dark:bg-soft-black/80 backdrop-blur-lg transition-all duration-300 relative">
    <div class="absolute inset-x-0 bottom-0 h-0.5 bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between relative">
      <div class="flex items-center space-x-12">
        <h1 class="text-2xl font-serif font-semibold tracking-wide text-black dark:text-white cursor-pointer" onclick="showTab('question')">
          MR. RABBIT'S GAME
        </h1>
        <nav class="hidden sm:flex space-x-8">
          <button onclick="showTab('question')" id="tab-question" class="font-medium text-sm tracking-wide uppercase pb-1">Pregunta</button>
          <button onclick="showTab('plans')" id="tab-plans" class="font-medium text-sm tracking-wide uppercase pb-1 text-gray-500 dark:text-gray-400">Planes</button>
          <button onclick="showTab('users')" id="tab-users" class="font-medium text-sm tracking-wide uppercase pb-1 text-gray-500 dark:text-gray-400">Usuarios</button>
          <button onclick="showTab('rules')" id="tab-rules" class="font-medium text-sm tracking-wide uppercase pb-1 text-gray-500 dark:text-gray-400">Reglas</button>
        </nav>
        <button id="mobile-menu-button" class="text-2xl text-black dark:text-white" onclick="toggleMobileMenu()">‚ò∞</button>
      </div>
      <div class="flex items-center space-x-4">
        <div class="flex items-center rounded-full border border-gray-200 dark:border-gray-700 p-1 bg-gray-100 dark:bg-soft-black/50 space-x-1">
          <button onclick="setTheme('light')" aria-label="Cambiar a modo claro" class="p-1.5 rounded-full bg-white dark:bg-transparent transition-colors duration-300">
            <svg class="w-5 h-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>
          </button>
          <button onclick="setTheme('dark')" aria-label="Cambiar a modo oscuro" class="p-1.5 rounded-full bg-transparent dark:bg-gray-700 transition-colors duration-300">
            <svg class="w-5 h-5 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
          </button>
        </div>
        <div id="auth-container">
            <button id="login-btn" class="text-sm tracking-wider uppercase text-black border border-black dark:text-white dark:border-white px-6 py-2 font-medium hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all duration-300 rounded-full">
              INICIAR SESI√ìN
            </button>
        </div>
      </div>
    </div>
    <div id="mobile-menu" class="hidden">
      <div class="flex flex-col space-y-3 py-2">
        <button onclick="showTab('question'); toggleMobileMenu()" class="text-left font-medium text-sm uppercase pb-1 px-4">Pregunta</button>
        <button onclick="showTab('plans'); toggleMobileMenu()" class="text-left font-medium text-sm uppercase pb-1 text-gray-500 dark:text-gray-400 px-4">Planes</button>
        <button onclick="showTab('users'); toggleMobileMenu()" class="text-left font-medium text-sm uppercase pb-1 text-gray-500 dark:text-gray-400 px-4">Usuarios</button>
        <button onclick="showTab('rules'); toggleMobileMenu()" class="text-left font-medium text-sm uppercase pb-1 text-gray-500 dark:text-gray-400 px-4">Reglas</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

    <!-- Vista: Pregunta -->
    <div id="question-view" class="animate-slide-up">
      <div class="text-center mb-16 max-w-4xl mx-auto">
        <div class="inline-flex items-center space-x-3 mb-6">
          <div class="bg-black dark:bg-white text-white dark:text-black px-6 py-3 text-sm font-medium rounded-full border border-black dark:border-white shadow-lg flex items-center space-x-2">
            <div class="w-3 h-3 rounded-full bg-white dark:bg-black animate-pulse"></div>
            <span>PREGUNTA SEMANAL ‚Ä¢ +10‚Ç¨ PREMIO</span>
          </div>
        </div>
        <h1 id="current-question" class="text-5xl md:text-6xl font-serif leading-tight mb-6 text-black dark:text-white">Cargando pregunta...</h1>
        <div class="mb-8">
          <button onclick="handleResponderClick()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-10 py-4 text-xl font-medium tracking-wide uppercase rounded-full shadow-lg hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-300 animate-pulse-button dark:btn-respond-glow">
            Responder
          </button>
        </div>
        <div class="flex items-center justify-center space-x-4 mb-8">
          <div class="flex-1 max-w-xs">
            <div class="w-full bg-gray-200 dark:bg-gray-800 rounded-full h-1.5">
              <div id="progress-bar" class="h-1.5 rounded-full bg-black dark:bg-white transition-all duration-1000" style="width: 20%"></div>
            </div>
          </div>
          <div class="flex space-x-4 text-sm font-medium">
            <div class="text-center"><div id="days" class="text-2xl font-bold text-black dark:text-white">05</div><div class="text-gray-500 dark:text-gray-400">d√≠as</div></div>
            <div class="text-center"><div id="hours" class="text-2xl font-bold text-black dark:text-white">18</div><div class="text-gray-500 dark:text-gray-400">horas</div></div>
            <div class="text-center"><div id="minutes" class="text-2xl font-bold text-black dark:text-white">42</div><div class="text-gray-500 dark:text-gray-400">min</div></div>
            <div class="text-center"><div id="seconds" class="text-2xl font-bold text-black dark:text-white">13</div><div class="text-gray-500 dark:text-gray-400">seg</div></div>
          </div>
        </div>
      </div>

      <div class="mt-8 bg-white dark:bg-soft-black/50 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
        <h2 class="text-2xl font-serif text-center mb-4 text-black dark:text-white animate-neon-pulse">
          Mr. Rabbit
        </h2>
        <div class="aspect-video bg-black rounded-lg overflow-hidden">
          <iframe 
            width="100%" 
            height="100%" 
            src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=0" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen 
            title="Mr. Rabbit"
            class="rounded-lg"
          ></iframe>
        </div>
      </div>

      <div class="mt-12">
        <h2 class="text-2xl font-serif mb-8 text-black dark:text-white text-center">Respuestas Recientes</h2>
        <div id="responses-container" class="space-y-6"></div>
      </div>
    </div>

    <!-- Vista: Planes -->
    <div id="plans-view" class="hidden animate-slide-up">
      <h1 class="text-5xl font-serif text-center mb-16 text-black dark:text-white">Planes de membres√≠a</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10 max-w-5xl mx-auto">
        <div class="p-8 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-soft-black card-hover">
          <h3 class="text-2xl font-serif mb-4 text-black dark:text-white">B√ÅSICO</h3>
          <ul class="space-y-3 mt-4 text-gray-600 dark:text-gray-300 font-light">
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Preguntas semanales</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Premios de 10‚Ç¨</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Participaci√≥n ilimitada</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Anonimato garantizado</span></li>
          </ul>
          <div class="mt-8 text-3xl font-serif text-black dark:text-white">Gratis</div>
          <button onclick="openLogin()" class="mt-6 w-full py-3 bg-black dark:bg-white text-white dark:text-black text-sm font-medium tracking-wider uppercase rounded-full hover:opacity-90 transition-transform transform hover:scale-105">
            REGISTRARSE
          </button>
        </div>
        <div class="p-8 rounded-2xl border-2 border-black dark:border-white bg-black dark:bg-white text-white dark:text-black card-hover relative overflow-visible">
          <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 z-20">
            <div class="bg-white dark:bg-black text-black dark:text-white px-5 py-2 text-xs font-bold rounded-full border border-white dark:border-black shadow-lg flex items-center space-x-2 badge-glow animate-shine">
              <div class="w-1.5 h-1.5 rounded-full bg-black dark:bg-white animate-pulse"></div>
              <span>M√ÅS POPULAR</span>
            </div>
          </div>
          <h3 class="text-2xl font-serif mb-4 mt-6">VIP</h3>
          <ul class="space-y-3 mt-4 text-gray-200 dark:text-gray-800 font-light">
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-yellow-400 dark:text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Todas las funciones b√°sicas</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-yellow-400 dark:text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Preguntas quincenales (50‚Ç¨)</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-yellow-400 dark:text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Preguntas mensuales (100‚Ç¨)</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-yellow-400 dark:text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Prioridad en selecci√≥n</span></li>
            <li class="flex items-center space-x-2"><svg class="w-4 h-4 text-yellow-400 dark:text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Acceso anticipado</span></li>
          </ul>
          <div class="mt-8 text-3xl font-serif text-white dark:text-black">4.99‚Ç¨ / mes</div>
          <button onclick="openLogin()" class="mt-6 w-full py-3 bg-white dark:bg-black text-black dark:text-white text-sm font-medium tracking-wider uppercase rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-transform transform hover:scale-105">
            SUSCRIBIRSE
          </button>
        </div>
      </div>
    </div>

    <!-- Vista: Usuarios -->
    <div id="users-view" class="hidden animate-slide-up">
      <h1 class="text-5xl font-serif mb-12 text-center text-black dark:text-white">Usuarios del Juego</h1>
      <div id="users-container" class="max-w-4xl mx-auto"></div>
    </div>

    <!-- Vista: Reglas -->
    <div id="rules-view" class="hidden animate-slide-up">
      <h1 class="text-5xl font-serif text-center mb-12 text-black dark:text-white animate-neon-pulse">Reglas del Juego</h1>
      <div class="max-w-5xl mx-auto space-y-10">
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">üéÆ</span> Mec√°nica del Juego</h2><ul class="space-y-4 text-lg"><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Cada participante puede responder <strong>1 pregunta por semana</strong></span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Las respuestas tienen <strong>libre albedr√≠o</strong>: puedes ser creativo, original y expresarte como desees</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>No hay respuestas correctas o incorrectas, solo respuestas que gusten m√°s o menos a <strong>Mr. Rabbit</strong></span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span><strong>Mr. Rabbit</strong> elige la respuesta ganadora bas√°ndose en su criterio personal y subjetivo</span></li></ul></section>
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">üí∞</span> Premios y Categor√≠as</h2><div class="space-y-6 text-lg"><div class="elegant-card"><strong><span>üéØ</span> Pregunta Semanal: 10‚Ç¨</strong><p>Acceso libre para todos los usuarios registrados</p></div><div class="elegant-card"><strong><span>‚≠ê</span> Pregunta Quincenal VIP: 50‚Ç¨</strong><p>Exclusivo para usuarios VIP</p></div><div class="elegant-card"><strong><span>üëë</span> Pregunta Mensual VIP: 100‚Ç¨</strong><p>Exclusivo para usuarios VIP</p></div></div></section>
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">üìã</span> Requisitos de Participaci√≥n</h2><ul class="space-y-4 text-lg"><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Ser mayor de 18 a√±os</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Tener una cuenta registrada con email v√°lido</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Para preguntas quincenales y mensuales: tener suscripci√≥n VIP activa</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Solo se permite una respuesta por pregunta y por usuario</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Las respuestas deben enviarse dentro del plazo establecido</span></li></ul></section>
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">üèÜ</span> Proceso de Selecci√≥n y Pago</h2><ul class="space-y-4 text-lg"><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span><strong>Mr. Rabbit</strong> selecciona al ganador seg√∫n su criterio personal</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>El ganador ser√° contactado por email en un plazo de <strong>24 horas</strong></span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>El ganador debe responder al email indicando su m√©todo de pago preferido</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>Los m√©todos de pago disponibles ser√°n confirmados al contactar con el ganador</span></li><li class="flex items-start space-x-3"><span class="text-green-500 mt-1">‚úì</span><span>El pago se procesar√° en un m√°ximo de <strong>7 d√≠as h√°biles</strong> tras recibir los datos</span></li></ul></section>
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">‚ö†Ô∏è</span> T√©rminos Importantes</h2><ul class="space-y-4 text-lg"><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Las decisiones de <strong>Mr. Rabbit</strong> son finales e inapelables</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>No se revelar√° el criterio espec√≠fico de selecci√≥n</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Las respuestas pueden ser publicadas de forma an√≥nima en la web</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>El incumplimiento de las reglas resulta en descalificaci√≥n autom√°tica</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Si el ganador no responde en <strong>72 horas</strong>, se seleccionar√° otro ganador</span></li></ul></section>
        <section class="card-hover p-8 rounded-2xl"><h2 class="text-3xl font-serif mb-6 text-black dark:text-white flex items-center"><span class="text-2xl mr-3">üö´</span> Conductas Prohibidas</h2><ul class="space-y-4 text-lg"><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Contenido ofensivo, discriminatorio o inapropiado</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Spam o respuestas automatizadas</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Uso de m√∫ltiples cuentas por la misma persona</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Plagio o copia de respuestas de otros participantes</span></li><li class="flex items-start space-x-3"><span class="text-red-500 mt-1">‚úì</span><span>Intentos de manipulaci√≥n o hackeo del sistema</span></li></ul></section>
        <section class="text-center mt-12"><p class="text-lg font-light italic text-gray-600 dark:text-gray-400"><strong>üìå Nota Importante:</strong> La participaci√≥n en el juego implica la aceptaci√≥n total de estas reglas.</p><p class="mt-6 text-2xl font-serif text-black dark:text-white">El juego de Mr. Rabbit ‚Äî Donde la creatividad tiene premio</p></section>
      </div>
    </div>
  </main>

  <!-- Modal de Inicio de Sesi√≥n / Registro -->
  <div id="login-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white dark:bg-soft-black p-8 max-w-md w-full rounded-2xl border border-gray-200 dark:border-gray-700 shadow-2xl animate-slide-up">
      <h2 id="login-modal-title" class="text-2xl font-serif text-center mb-6 text-black dark:text-white">Participa en el juego</h2>
      <div class="space-y-4">
        <div id="username-field" class="hidden">
          <input type="text" id="login-username" placeholder="Tu nombre o pseud√≥nimo" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-soft-black rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white" />
        </div>
        <input type="email" id="login-email" placeholder="tu@email.com" autocomplete="email" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-soft-black rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white" required />
        <input type="password" id="login-password" placeholder="Contrase√±a" autocomplete="current-password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-soft-black rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white" required />
        <p id="login-error" class="text-red-500 text-sm text-center hidden"></p>
        <div id="action-buttons">
          <button id="signin-btn" type="button" class="w-full bg-black dark:bg-white text-white dark:text-black px-8 py-3 text-sm font-medium tracking-wider uppercase rounded-full hover:opacity-90">Iniciar Sesi√≥n</button>
          <button id="register-btn" type="button" class="w-full bg-black dark:bg-white text-white dark:text-black px-8 py-3 text-sm font-medium tracking-wider uppercase rounded-full hover:opacity-90 hidden">Registrarse</button>
        </div>
        <div class="text-center my-4 text-gray-500 dark:text-gray-400 text-xs">O</div>
        <button id="login-google-btn" type="button" class="w-full bg-white text-black px-8 py-3 font-medium tracking-wider rounded-full hover:opacity-90 border border-gray-300 flex items-center justify-center space-x-2">
          <svg class="w-5 h-5" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.5 24.3182C44.5 22.7273 44.3636 21.1818 44.0909 19.6818H24.5V28.3636H35.9545C35.3182 31.0909 33.6364 33.3636 31.2727 34.8636V40.2273H38.5C42.3182 36.7273 44.5 31.0455 44.5 24.3182Z" fill="#4285F4"/><path d="M24.5 45C30.0909 45 34.8182 43.1364 38.5 40.2273L31.2727 34.8636C29.2273 36.2727 26.9545 37.0455 24.5 37.0455C19.4545 37.0455 15.1364 33.7273 13.6364 29.1818H6.13636V34.6364C9.81818 41.0909 16.6364 45 24.5 45Z" fill="#34A853"/><path d="M13.6364 29.1818C13.1364 27.7727 12.8636 26.2727 12.8636 24.75C12.8636 23.2273 13.1364 21.7273 13.6364 20.3182V14.8636H6.13636C4.40909 18.1364 3.5 21.3636 3.5 24.75C3.5 28.1364 4.40909 31.3636 6.13636 34.6364L13.6364 29.1818Z" fill="#FBBC05"/><path d="M24.5 12.4545C27.2727 12.4545 29.6818 13.3636 31.6364 15.2273L38.6818 8.22727C34.8182 4.81818 30.0909 3 24.5 3C16.6364 3 9.81818 6.90909 6.13636 14.8636L13.6364 20.3182C15.1364 15.7727 19.4545 12.4545 24.5 12.4545Z" fill="#EA4335"/></svg>
          <span>Continuar con Google</span>
        </button>
        <p id="toggle-form" class="text-center text-sm text-gray-500 dark:text-gray-400 mt-4">¬øNo tienes cuenta? <button class="font-semibold text-black dark:text-white hover:underline">Reg√≠strate</button></p>
      </div>
      <button type="button" onclick="closeLogin()" class="w-full text-sm mt-6 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white text-center">
        CANCELAR
      </button>
    </div>
  </div>


  <!-- Modal de Respuesta -->
  <div id="response-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white dark:bg-soft-black p-8 max-w-lg w-full rounded-2xl border border-gray-200 dark:border-gray-700 shadow-2xl animate-slide-up">
      <h2 id="response-modal-question" class="text-2xl font-serif mb-4 text-black dark:text-white"></h2>
      <div id="response-form" class="space-y-4">
        <textarea id="response-textarea" rows="5" placeholder="Escribe aqu√≠ tu reflexi√≥n..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-soft-black rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white" required></textarea>
        <button id="submit-response-btn" type="button" onclick="submitResponse()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-8 py-3 text-sm font-medium tracking-wider uppercase rounded-full hover:opacity-90">
          ENVIAR RESPUESTA
        </button>
      </div>
      <button type="button" onclick="closeResponseModal()" class="w-full text-sm mt-4 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white text-center">
        CANCELAR
      </button>
    </div>
  </div>

  <!-- Modal Legal -->
  <div id="legal-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white dark:bg-soft-black p-8 max-w-3xl w-full rounded-2xl border border-gray-200 dark:border-gray-700 shadow-2xl animate-slide-up max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-start mb-6">
        <h2 class="text-2xl font-serif text-black dark:text-white" id="legal-modal-title"></h2>
        <button onclick="closeLegalModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl leading-none">√ó</button>
      </div>
      <div id="legal-modal-content" class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed space-y-4"></div>
      <div class="mt-8 text-center">
        <button onclick="closeLegalModal()" class="px-6 py-2 bg-black dark:bg-white text-white dark:text-black text-sm font-medium rounded-full hover:opacity-90 transition">
          Cerrar
        </button>
      </div>
    </div>
  </div>
  
  <!-- Modal de Notificaci√≥n -->
  <div id="notification-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white dark:bg-soft-black p-8 max-w-sm w-full rounded-2xl border border-gray-200 dark:border-gray-700 shadow-2xl animate-slide-up text-center">
      <p id="notification-message" class="text-lg text-black dark:text-white mb-6"></p>
      <button onclick="closeNotificationModal()" class="w-full bg-black dark:bg-white text-white dark:text-black px-8 py-3 text-sm font-medium tracking-wider uppercase rounded-full hover:opacity-90">
        ENTENDIDO
      </button>
    </div>
  </div>


  <!-- Pie de p√°gina -->
  <footer class="border-t border-gray-200 dark:border-gray-700 py-12 mt-24 bg-white/60 dark:bg-soft-black/60">
    <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 dark:text-gray-400 text-sm space-y-4">
      <p>¬© 2025 Mr. Rabbit's Game. Todos los derechos reservados.</p>
      <div class="flex flex-wrap justify-center gap-6 text-sm">
        <button onclick="openLegalModal('privacy')" class="hover:text-black dark:hover:text-white transition-colors duration-200 underline-offset-4 hover:underline">Pol√≠tica de Privacidad</button>
        <button onclick="openLegalModal('terms')" class="hover:text-black dark:hover:text-white transition-colors duration-200 underline-offset-4 hover:underline">Condiciones de Uso</button>
        <button onclick="openLegalModal('legal')" class="hover:text-black dark:hover:text-white transition-colors duration-200 underline-offset-4 hover:underline">Avisos Legales</button>
      </div>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyCBC7rDIdeMMboTKIz2OWfGRHzzf182vrE",
      authDomain: "mrrabbitgame-ebb08.firebaseapp.com",
      projectId: "mrrabbitgame-ebb08",
      storageBucket: "mrrabbitgame-ebb08.firebasestorage.app",
      messagingSenderId: "485494196426",
      appId: "1:485494196426:web:ace9b7e790570d541c8c33"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const SHEETY_API_URL = "https://api.sheety.co/74cbbe943cc8e5f84d5942a157029f41/mrRabbitGame";
    const RESPONSES_ENDPOINT = `${SHEETY_API_URL}/paneldecontrol`;
    const USERS_ENDPOINT = `${SHEETY_API_URL}/usuarios`;
    
    let isLoggedIn = false;
    let currentUser = null;
    let currentQuestion = "";
    let allResponses = [];
    
    // --- Autenticaci√≥n de Firebase ---
    
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            isLoggedIn = true;
            currentUser = user;
            if (user.displayName) { // Solo registrar si ya tiene nombre
                await registerUserInSheetIfNeeded(user);
            }
            updateAuthUI(user);
             if (localStorage.getItem('pendingAction') === 'respond') {
                localStorage.removeItem('pendingAction'); 
                openResponseModal();
            }
        } else {
            isLoggedIn = false;
            currentUser = null;
            updateAuthUI(null);
        }
    });

    async function signInWithGoogle() {
        try {
            await signInWithPopup(auth, provider);
            closeLogin();
        } catch (error) {
            console.error("Error al iniciar sesi√≥n con Google:", error);
            showLoginError("No se pudo iniciar sesi√≥n con Google.");
        }
    }

    async function handleEmailSignIn() {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        if (!email || !password) {
            showLoginError("Por favor, introduce email y contrase√±a.");
            return;
        }
        try {
            await signInWithEmailAndPassword(auth, email, password);
            closeLogin();
        } catch (error) {
            console.error("Error al iniciar sesi√≥n:", error.code);
            showLoginError(getAuthErrorMessage(error.code));
        }
    }

    async function handleEmailRegister() {
        const username = document.getElementById('login-username').value.trim();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        if (!username || !email || !password) {
            showLoginError("Todos los campos son obligatorios.");
            return;
        }
         if (password.length < 6) {
            showLoginError("La contrase√±a debe tener al menos 6 caracteres.");
            return;
        }
        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(userCredential.user, { displayName: username });
            // Forzar recarga de usuario para obtener displayName actualizado
            await userCredential.user.reload();
            currentUser = auth.currentUser; // Actualizar la variable global
            await registerUserInSheetIfNeeded(currentUser);
            closeLogin();
        } catch (error) {
            console.error("Error al registrar:", error.code);
            showLoginError(getAuthErrorMessage(error.code));
        }
    }

    async function signOutUser() {
        try {
            await signOut(auth);
        } catch (error) {
            console.error("Error al cerrar sesi√≥n:", error);
        }
    }

    async function registerUserInSheetIfNeeded(user) {
        if (!user || !user.email || !user.displayName) return;
        try {
            const response = await fetch(USERS_ENDPOINT);
            const data = await response.json();
            const existingUsers = data.usuarios || [];
            const userExists = existingUsers.some(u => u.email && u.email.toLowerCase() === user.email.toLowerCase());

            if (!userExists) {
                const newUser = {
                    usuario: {
                        username: user.displayName,
                        email: user.email,
                        registrationTimestamp: new Date().toISOString()
                    }
                };
                await fetch(USERS_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newUser)
                });
            }
        } catch (error) {
            console.error("Error al registrar el usuario en Sheety:", error);
        }
    }

    // --- L√≥gica de la aplicaci√≥n ---

    document.addEventListener('DOMContentLoaded', () => {
      initializeTheme();
      showTab('question');
      loadInitialData();
      updateTimer();
      setInterval(updateTimer, 1000);
      setupAuthModal();
    });
    
    function updateAuthUI(user) {
        const authContainer = document.getElementById('auth-container');
        if (user) {
            authContainer.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-sm font-medium text-black dark:text-white hidden sm:block">HOLA, ${user.displayName ? user.displayName.split(' ')[0].toUpperCase() : ''}</span>
                    <button id="logout-btn" class="text-sm tracking-wider uppercase bg-red-500 text-white px-4 py-2 font-medium hover:bg-red-600 transition-all duration-300 rounded-full">
                      SALIR
                    </button>
                </div>
            `;
            document.getElementById('logout-btn').addEventListener('click', signOutUser);
        } else {
             authContainer.innerHTML = `
                <button id="login-btn" class="text-sm tracking-wider uppercase text-black border border-black dark:text-white dark:border-white px-6 py-2 font-medium hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all duration-300 rounded-full">
                  INICIAR SESI√ìN
                </button>
            `;
            document.getElementById('login-btn').addEventListener('click', openLogin);
        }
    }

    async function loadInitialData() {
      await loadCurrentQuestion();
      await loadRecentResponses();
      await renderUsersView();
    }

    async function loadCurrentQuestion() {
      try {
        const response = await fetch(CONFIG_ENDPOINT);
        if (!response.ok) throw new Error();
        const data = await response.json();
        currentQuestion = data.config.find(item => item.clave === 'preguntaActual')?.valor || 'La pregunta no est√° disponible.';
      } catch { currentQuestion = 'No se pudo cargar la pregunta.'; }
      document.getElementById('current-question').textContent = currentQuestion;
    }

    async function loadRecentResponses() {
      const container = document.getElementById('responses-container');
      container.innerHTML = '<p class="text-center text-gray-400">Cargando respuestas...</p>';
      try {
        const response = await fetch(RESPONSES_ENDPOINT);
        if (!response.ok) throw new Error();
        const data = await response.json();
        allResponses = data.paneldecontrol || [];
        allResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        container.innerHTML = '';
        if (allResponses.length === 0) {
          container.innerHTML = '<p class="text-center text-gray-400">A√∫n no hay respuestas. ¬°S√© el primero!</p>';
          return;
        }
        allResponses.slice(0, 5).forEach(resp => {
          const card = document.createElement('div');
          card.className = "border border-gray-200 dark:border-gray-700 rounded-2xl p-6 bg-white dark:bg-soft-black card-hover";
          card.innerHTML = `
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center space-x-4">
                <span class="text-sm ${resp.esVip === "S√≠" ? 'glitch-name' : 'text-black dark:text-white'}">${escapeHTML(resp.nombre)}</span>
                <span class="text-xs text-gray-500 dark:text-gray-400">hace ${timeAgo(resp.timestamp)}</span>
              </div>
              ${resp.esVip === "S√≠" ? `<div class="text-yellow-500 font-bold">VIP</div>` : ''}
            </div>
            <p class="text-lg leading-relaxed text-gray-800 dark:text-gray-200 font-light">${escapeHTML(resp.respuesta)}</p>
          `;
          container.appendChild(card);
        });
      } catch {
        container.innerHTML = '<p class="text-center text-red-500">Error al cargar las respuestas.</p>';
      }
    }

    async function renderUsersView() {
        const container = document.getElementById('users-container');
        container.innerHTML = '<div class="p-8 text-center text-gray-500 dark:text-gray-400">Cargando usuarios y respuestas...</div>';

        try {
            // Fetch users and responses in parallel
            const [usersResponse, responsesResponse] = await Promise.all([
                fetch(USERS_ENDPOINT),
                fetch(RESPONSES_ENDPOINT)
            ]);

            if (!usersResponse.ok) throw new Error('Failed to fetch users');
            if (!responsesResponse.ok) throw new Error('Failed to fetch responses');

            const usersData = await usersResponse.json();
            const responsesData = await responsesResponse.json();

            const allUsers = usersData.usuarios || [];
            const allResponses = responsesData.paneldecontrol || [];

            if (allUsers.length === 0) {
                container.innerHTML = '<p class="p-8 text-center text-gray-500 dark:text-gray-400">A√∫n no hay usuarios registrados.</p>';
                return;
            }

            // Create a map of responses by email for efficient lookup
            const responsesByEmail = allResponses.reduce((acc, response) => {
                const email = response.email.toLowerCase();
                if (!acc[email]) {
                    acc[email] = [];
                }
                acc[email].push(response);
                return acc;
            }, {});

            // Sort users by registration date
            allUsers.sort((a, b) => new Date(a.registrationTimestamp) - new Date(b.registrationTimestamp));
            
            container.innerHTML = ''; // Clear loading message
            const userListContainer = document.createElement('div');
            userListContainer.className = "space-y-8";

            allUsers.forEach(user => {
                const userResponses = responsesByEmail[user.email.toLowerCase()] || [];
                
                const userCard = document.createElement('div');
                userCard.className = "card-hover p-6 md:p-8 rounded-2xl";

                let responsesHtml = '<p class="text-sm text-gray-500 dark:text-gray-400 mt-4">Este usuario a√∫n no ha respondido a ninguna pregunta.</p>';
                if (userResponses.length > 0) {
                    // Sort responses by date, newest first
                    userResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    responsesHtml = userResponses.map(resp => `
                        <div class="elegant-card mt-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Respuesta a: <strong>"${escapeHTML(resp.pregunta)}"</strong></p>
                            <p class="text-gray-800 dark:text-gray-200">${escapeHTML(resp.respuesta)}</p>
                        </div>
                    `).join('');
                }
                
                userCard.innerHTML = `
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                        <div>
                            <h3 class="text-2xl font-serif text-black dark:text-white">${escapeHTML(user.username)}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Miembro desde: ${new Date(user.registrationTimestamp).toLocaleDateString()}</p>
                        </div>
                        <div class="mt-2 sm:mt-0 text-sm font-medium text-black dark:text-white bg-gray-100 dark:bg-soft-black/50 py-1 px-3 rounded-full">
                            ${userResponses.length} ${userResponses.length === 1 ? 'Respuesta' : 'Respuestas'}
                        </div>
                    </div>
                    <div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="font-semibold text-black dark:text-white">Actividad Reciente</h4>
                        ${responsesHtml}
                    </div>
                `;
                userListContainer.appendChild(userCard);
            });

            container.appendChild(userListContainer);

        } catch (error) {
            console.error("Error rendering users view:", error);
            container.innerHTML = '<p class="p-8 text-center text-red-500">Error al cargar la informaci√≥n de los usuarios.</p>';
        }
    }

    function handleResponderClick() {
      if (isLoggedIn) {
        openResponseModal();
      } else {
        localStorage.setItem('pendingAction', 'respond');
        openLogin();
      }
    }

    async function submitResponse() {
      if (!currentUser) {
        showNotification("Debes iniciar sesi√≥n para responder.");
        return;
      }
      const textArea = document.getElementById('response-textarea');
      const userResponse = textArea.value.trim();
      if (userResponse === "") { 
        showNotification("Por favor, escribe una respuesta."); 
        return; 
      }
      const button = document.getElementById('submit-response-btn');
      button.disabled = true; 
      button.textContent = "ENVIANDO...";
      const dataToSend = { 
        paneldecontrol: {
          id: Date.now(), 
          nombre: currentUser.displayName, 
          email: currentUser.email,
          respuesta: userResponse, 
          pregunta: currentQuestion, 
          timestamp: new Date().toISOString(), 
          esVip: "No"
        }
      };
      try {
        const response = await fetch(RESPONSES_ENDPOINT, {
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(dataToSend)
        });
        if (!response.ok) throw new Error();
        showNotification("¬°Tu respuesta ha sido enviada con √©xito!");
        closeResponseModal(); 
        textArea.value = ""; 
        loadInitialData();
      } catch { 
        showNotification("Hubo un problema al enviar tu respuesta."); 
      } finally { 
        button.disabled = false; 
        button.textContent = "ENVIAR RESPUESTA"; 
      }
    }
    
    // --- Funciones de utilidad y UI ---

    function setupAuthModal() {
        let isRegisterMode = false;
        const usernameField = document.getElementById('username-field');
        const signinBtn = document.getElementById('signin-btn');
        const registerBtn = document.getElementById('register-btn');
        const toggleForm = document.getElementById('toggle-form');
        const modalTitle = document.getElementById('login-modal-title');
        
        function setAuthModalMode(isRegister) {
            isRegisterMode = isRegister;
            showLoginError(''); // Hide error on mode switch
            if (isRegister) {
                modalTitle.textContent = "Crea tu cuenta";
                usernameField.classList.remove('hidden');
                signinBtn.classList.add('hidden');
                registerBtn.classList.remove('hidden');
                toggleForm.innerHTML = '¬øYa tienes cuenta? <button class="font-semibold text-black dark:text-white hover:underline">Inicia sesi√≥n</button>';
            } else {
                modalTitle.textContent = "Participa en el juego";
                usernameField.classList.add('hidden');
                signinBtn.classList.remove('hidden');
                registerBtn.classList.add('hidden');
                toggleForm.innerHTML = '¬øNo tienes cuenta? <button class="font-semibold text-black dark:text-white hover:underline">Reg√≠strate</button>';
            }
            toggleForm.querySelector('button').addEventListener('click', (e) => {
                e.preventDefault();
                setAuthModalMode(!isRegisterMode)
            });
        }

        toggleForm.querySelector('button').addEventListener('click', (e) => {
             e.preventDefault();
             setAuthModalMode(true)
        });
        document.getElementById('login-google-btn').addEventListener('click', signInWithGoogle);
        signinBtn.addEventListener('click', handleEmailSignIn);
        registerBtn.addEventListener('click', handleEmailRegister);
    }
    
    function showLoginError(message) {
        const errorP = document.getElementById('login-error');
        errorP.textContent = message;
        if (message) {
            errorP.classList.remove('hidden');
        } else {
            errorP.classList.add('hidden');
        }
    }
    
    function getAuthErrorMessage(errorCode) {
        switch (errorCode) {
            case 'auth/invalid-email':
                return 'El formato del email no es v√°lido.';
            case 'auth/user-not-found':
            case 'auth/wrong-password':
                return 'Email o contrase√±a incorrectos.';
            case 'auth/email-already-in-use':
                return 'Este email ya est√° registrado.';
            case 'auth/weak-password':
                 return 'La contrase√±a es demasiado d√©bil.';
            default:
                return 'Ha ocurrido un error. Int√©ntalo de nuevo.';
        }
    }
    
    function showNotification(message) {
        document.getElementById('notification-message').textContent = message;
        document.getElementById('notification-modal').classList.remove('hidden');
    }

    window.closeNotificationModal = function() {
        document.getElementById('notification-modal').classList.add('hidden');
    }

    window.openLogin = function() { document.getElementById('login-modal').classList.remove('hidden'); }
    window.closeLogin = function() { document.getElementById('login-modal').classList.add('hidden'); }
    window.openResponseModal = function() {
      document.getElementById('response-modal-question').textContent = currentQuestion;
      document.getElementById('response-modal').classList.remove('hidden'); 
    }
    window.closeResponseModal = function() { document.getElementById('response-modal').classList.add('hidden'); }

    window.showTab = function(tabId) {
      ['question', 'plans', 'users', 'rules'].forEach(id => document.getElementById(`${id}-view`).classList.add('hidden'));
      ['tab-question', 'tab-plans', 'tab-users', 'tab-rules'].forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('active-tab', 'text-black', 'dark:text-white');
        el.classList.add('text-gray-500', 'dark:text-gray-400');
      });
      document.getElementById(`${tabId}-view`).classList.remove('hidden');
      const activeTab = document.getElementById(`tab-${tabId}`);
      activeTab.classList.add('active-tab', 'text-black', 'dark:text-white');
      activeTab.classList.remove('text-gray-500', 'dark:text-gray-400');
    }

    function timeAgo(dateString) {
      const diffInSeconds = Math.floor((new Date() - new Date(dateString)) / 1000);
      if (Math.floor(diffInSeconds / 86400) > 0) return `${Math.floor(diffInSeconds / 86400)}d`;
      if (Math.floor(diffInSeconds / 3600) > 0) return `${Math.floor(diffInSeconds / 3600)}h`;
      if (Math.floor(diffInSeconds / 60) > 0) return `${Math.floor(diffInSeconds / 60)}m`;
      return 'ahora';
    }

    function escapeHTML(str) { return str ? str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;') : ''; }
    window.setTheme = function(theme) { document.documentElement.classList.toggle('dark', theme === 'dark'); localStorage.setItem('theme', theme); }
    function initializeTheme() { const stored = localStorage.getItem('theme'), prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches; setTheme(stored === 'dark' || (!stored && prefersDark) ? 'dark' : 'light'); }

    function updateTimer() {
      const now = new Date();
      const saturday = new Date();
      saturday.setDate(saturday.getDate() + (6 - saturday.getDay() + 7) % 7);
      saturday.setHours(23, 59, 59, 999);
      const diff = saturday - now;
      if (diff <= 0) {
        ['days', 'hours', 'minutes', 'seconds'].forEach(id => document.getElementById(id).textContent = '00');
        document.getElementById('progress-bar').style.width = '100%';
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / 1000 / 60) % 60);
      const seconds = Math.floor((diff / 1000) % 60);
      document.getElementById('days').textContent = String(days).padStart(2, '0');
      document.getElementById('hours').textContent = String(hours).padStart(2, '0');
      document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
      document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
      const totalSecondsInWeek = 7 * 24 * 60 * 60;
      const secondsRemaining = diff / 1000;
      const progress = 100 - (secondsRemaining / totalSecondsInWeek * 100);
      document.getElementById('progress-bar').style.width = `${Math.max(0, progress)}%`;
    }

    window.toggleMobileMenu = function() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }

    // === MODALES LEGALES ===
    window.openLegalModal = function(type) {
      const titleEl = document.getElementById('legal-modal-title');
      const contentEl = document.getElementById('legal-modal-content');
      if (type === 'privacy') {
        titleEl.textContent = 'Pol√≠tica de Privacidad';
        contentEl.innerHTML = `
          <p><strong>√öltima actualizaci√≥n:</strong> Agosto 2025</p>
          <p>En <strong>Mr. Rabbit's Game</strong>, respetamos tu privacidad y nos comprometemos a proteger tus datos personales. Esta Pol√≠tica de Privacidad explica c√≥mo recopilamos, usamos y compartimos tu informaci√≥n cuando utilizas nuestra plataforma.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">1. Informaci√≥n que recopilamos</h3>
          <p>Recopilamos informaci√≥n que nos proporcionas directamente, como tu correo electr√≥nico al registrarte con un proveedor de autenticaci√≥n (por ejemplo, Google). No almacenamos datos sensibles ni compartimos tu informaci√≥n con terceros sin tu consentimiento.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">2. Uso de la informaci√≥n</h3>
          <p>Utilizamos tus datos para gestionar tu cuenta, enviarte notificaciones sobre preguntas semanales y premios, y contactarte si resultas ganador.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">3. Seguridad</h3>
          <p>Implementamos medidas t√©cnicas y organizativas para proteger tus datos contra accesos no autorizados.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">4. Tus derechos</h3>
          <p>Tienes derecho a acceder, rectificar o eliminar tus datos. Puedes ejercer estos derechos contact√°ndonos a trav√©s del correo proporcionado en Avisos Legales.</p>
          <p>Al usar Mr. Rabbit's Game, aceptas esta Pol√≠tica de Privacidad.</p>
        `;
      }
      if (type === 'terms') {
        titleEl.textContent = 'Condiciones de Uso';
        contentEl.innerHTML = `
          <p><strong>√öltima actualizaci√≥n:</strong> Agosto 2025</p>
          <p>Las presentes Condiciones de Uso regulan el acceso y participaci√≥n en <strong>Mr. Rabbit's Game</strong>, una plataforma de debates filos√≥ficos semanales con premios.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">1. Aceptaci√≥n de los t√©rminos</h3>
          <p>Al registrarte o participar, aceptas cumplir con estas condiciones. Si no est√°s de acuerdo, no uses la plataforma.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">2. Participaci√≥n</h3>
          <p>La participaci√≥n est√° limitada a personas mayores de 18 a√±os. Cada usuario puede enviar una √∫nica respuesta por pregunta.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">3. Contenido</h3>
          <p>El contenido que env√≠as debe ser original y no ofensivo. Nos reservamos el derecho a rechazar respuestas que violen estas normas.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">4. Premios</h3>
          <p>Los premios son otorgados a criterio de <strong>Mr. Rabbit</strong>. El ganador ser√° contactado por correo. El premio no es transferible.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">5. Modificaciones</h3>
          <p>Nos reservamos el derecho a modificar estas condiciones en cualquier momento. Se notificar√° cualquier cambio significativo.</p>
        `;
      }
      if (type === 'legal') {
        titleEl.textContent = 'Avisos Legales';
        contentEl.innerHTML = `
          <p><strong>Nombre del sitio:</strong> Mr. Rabbit's Game</p>
          <p><strong>Propietario:</strong> Proyecto Filos√≥fico An√≥nimo SL</p>
          <p><strong>Domicilio:</strong> Calle Filosof√≠a, 123, 28001 Madrid, Espa√±a</p>
          <p><strong>NIF:</strong> B-12345678</p>
          <p><strong>Contacto:</strong> <a href="mailto:hola@mrrabbitsgame.com" class="text-blue-600 dark:text-blue-400 hover:underline">hola@mrrabbitsgame.com</a></p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">1. Jurisdicci√≥n</h3>
          <p>Estos avisos se rigen por las leyes espa√±olas. Cualquier disputa se resolver√° en los tribunales de Madrid.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">2. Propiedad intelectual</h3>
          <p>El dise√±o, c√≥digo y contenido de este sitio son propiedad de Mr. Rabbit's Game. Queda prohibida su reproducci√≥n sin permiso.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">3. Limitaci√≥n de responsabilidad</h3>
          <p>No nos hacemos responsables de decisiones basadas en los debates, ni de fallos t√©cnicos temporales. La participaci√≥n es bajo tu propia responsabilidad.</p>
          <h3 class="text-lg font-semibold text-black dark:text-white mt-4">4. Cookies</h3>
          <p>Este sitio utiliza cookies t√©cnicas para el funcionamiento b√°sico. No usamos cookies de seguimiento ni publicitarias.</p>
        `;
      }
      document.getElementById('legal-modal').classList.remove('hidden');
    }
    
    window.closeLegalModal = function() {
      document.getElementById('legal-modal').classList.add('hidden');
    }

    // --- Hacer funciones accesibles globalmente ---
    window.handleResponderClick = handleResponderClick;
    window.submitResponse = submitResponse;

  </script>
</body>
</html>

